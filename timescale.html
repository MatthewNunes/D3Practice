<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <script type="text/javascript" src="d3.js">
    </script>
  </head>
  <body>
    <script type="text/javascript">
      var w = 1000;
      var h = 500;
      var padding = 70;
      var parseTime = d3.timeParse("%m/%d/%y");
      var minDate;
      var maxDate;
      var maxAmount;

      var rowConverter = function (data) {
          data.forEach(function (d) {
            d.Date = parseTime(d.Date);
            d.Amount = parseInt(d.Amount);
          });
          return data;
      };

      var dataset = []
      var arrayAppender = function (data) {
        data.forEach(function(d) {
          dataset.push(d);
        })
        return;
      };

      var formatTime = d3.timeFormat("%b %e");

      var dataPromise = d3.csv("time_scale_data.csv")
                      .then(rowConverter);
      var arrayPromise =  dataPromise.then(arrayAppender)
                                     .then(function (data) {
                                            minDate = d3.min(dataset, function (d) { return d.Date;})
                                          })
                                     .then(function (data) {
                                            maxDate = d3.max(dataset, function (d) { return d.Date; })
                                            maxAmount = d3.max(dataset, function (d) { return d.Amount;});
                                     })
                                     .then(function () {
                                       xScale = d3.scaleTime()
                                                  .domain([
                                                    minDate,
                                                    maxDate
                                                  ])
                                                  .range([padding, w-padding]);

                                       yScale = d3.scaleLinear()
                                                  .domain([0, maxAmount])
                                                  .range([h-padding, padding]);
                                     })
                                     .then(function () {
                                       var svg = d3.select("body")
                                                   .append("svg")
                                                   .attr("width", w)
                                                   .attr("height", h);

                                       svg.selectAll("circle")
                                          .data(dataset)
                                          .enter()
                                          .append("circle")
                                          .attr("cx", function (d){
                                            return xScale(d.Date);
                                          })
                                          .attr("cy", function (d) {
                                            return yScale(d.Amount);
                                          })
                                          .attr("r", 5);

                                      svg.selectAll("text")
                                         .data(dataset)
                                         .enter()
                                         .append("text")
                                         .text(function (d){
                                           return formatTime(d.Date);
                                         })
                                         .attr("x", function (d) {
                                           return xScale(d.Date) - 10;
                                         })
                                         .attr("y", function (d) {
                                           return yScale(d.Amount) - 5;
                                         })
                                         .attr("font-family", "sans-serif")
                                         .attr("font-size", "11px");
                                    });


      var toType = function(obj) {
        return ({}).toString.call(obj).match(/\s([a-zA-Z]+)/)[1].toLowerCase()
      }









    </script>
  </body>
</html>
